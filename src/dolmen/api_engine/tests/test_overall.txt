Dolmen API utilities
********************

  >>> from dolmen.api_engine.validation import allowed, validate

  >>> USERS = {}

  
  >>> from zope.schema import ASCIILine, List
  >>> from zope.interface import Interface
  >>> from dolmen.api_engine.responder import reply

  >>> class IUserAction(Interface):
  ...
  ...  username = ASCIILine(
  ...      title=u"User identifier",
  ...      required=True,
  ...      )

  >>> @allowed('POST')
  ... @validate(IUserAction, 'POST')
  ... def UserDetails(action_request, overhead):
  ...
  ...     user_details = USERS.get(action_request.username)
  ...     if user_details is not None:
  ...         return reply(200, text=json.dumps(user_details),
  ...                      content_type="application/json")
  ...
  ...     return reply(404, text="User not found.")

  >>> class IUsersListing(Interface):
  ...
  ...  departments = List(
  ...      title=u"Department identifiers, for an OR request",
  ...      required=False,
  ...      value_type=ASCIILine(),
  ...      )

  >>> UsersModule = {
  ...     '/details': UserDetails,
  ... }

  >>> from dolmen.api_engine.components import Endpoint
  >>> users_endpoint = Endpoint(UsersModule)

  >>> from webtest import TestApp
  >>> app = TestApp(users_endpoint)

  >>> resp = app.get('/', expect_errors=True)
  >>> resp.status
  '400 Bad Request'
  >>> resp.text
  'Provided action does not exist. Please consult the API documentation.'

  >>> resp = app.post('/details', expect_errors=True)
  >>> resp.status
  '400 Bad Request'
  >>> resp.text
  '`username`: Required input is missing.'

  >>> resp = app.post(
  ...     '/details', {'username': 'Alexandra'}, expect_errors=True)
  >>> resp.status
  '404 Not Found'
  >>> resp.text
  'User not found.'

